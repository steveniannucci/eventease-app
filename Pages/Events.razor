@page "/events"

<h1>Events</h1>

<div class="mb-3">
    <p class="text-muted">Showing @((currentPage - 1) * pageSize + 1) - @Math.Min(currentPage * pageSize, totalEvents) of @totalEvents events</p>
</div>

@foreach (var evt in currentPageEvents)
{
    <div class="d-flex align-items-center justify-content-between border-bottom py-2">
        <div class="me-3">
            <div class="fw-semibold">@evt.EventName</div>
            <small class="text-muted">@evt.EventDate.ToString("MMM dd, yyyy") • @evt.Location</small>
        </div>
        <div class="text-nowrap">
            <NavLink class="btn btn-sm btn-outline-secondary me-2" href=@($"/events/details/{evt.Id}")>Details</NavLink>
            <NavLink class="btn btn-sm btn-primary" href=@($"/events/register/{evt.Id}")>Register</NavLink>
        </div>
    </div>
}

<div class="mt-3 d-flex justify-content-between align-items-center">
    <button class="btn btn-secondary" @onclick="PreviousPage" disabled="@(currentPage == 1)">
        ← Previous
    </button>
    <span>Page @currentPage of @totalPages</span>
    <button class="btn btn-secondary" @onclick="NextPage" disabled="@(currentPage == totalPages)">
        Next →
    </button>
</div>

@code {
    public class EventItem
    {
        public int Id { get; set; }
        public string EventName { get; set; } = string.Empty;
        public DateTime EventDate { get; set; }
        public string Location { get; set; } = string.Empty;
    }

    private const int totalEvents = 40;
    private const int pageSize = 10;
    private int currentPage = 1;
    private int totalPages => (int)Math.Ceiling((double)totalEvents / pageSize);
    private List<EventItem> allEvents = new();
    private List<EventItem> currentPageEvents = new();

    protected override void OnInitialized()
    {
        // Generate all 40 events
        allEvents = Enumerable.Range(1, totalEvents).Select(i => new EventItem
        {
            Id = i,
            EventName = $"Event #{i}",
            EventDate = DateTime.Today.AddDays(i % 30),
            Location = "City Hall"
        }).ToList();

        LoadPage();
    }

    private void LoadPage()
    {
        var skip = (currentPage - 1) * pageSize;
        currentPageEvents = allEvents.Skip(skip).Take(pageSize).ToList();
    }

    private void NextPage()
    {
        if (currentPage < totalPages)
        {
            currentPage++;
            LoadPage();
        }
    }

    private void PreviousPage()
    {
        if (currentPage > 1)
        {
            currentPage--;
            LoadPage();
        }
    }
}
